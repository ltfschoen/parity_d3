<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<style>
			div.chart {
				font-family: sans-serif;
				font-size: 0.7em;
			}
			div.category {
				margin-left: 20px;
				line-height: 3em;
				margin-bottom: 2px;
			}
			span.label-wrapper {
				width: 100px;
				display: inline-block;
			}
			div.label {
				margin-left: 40px;
			}
			div.bar {
				margin-left: 20px;
				background-color: DarkRed;
				color: white;
				padding-right: 1em;
				text-align: right;
				outline: 1px solid black;
				display: inline-block;
			}
		</style>
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://parity.io/javascript_advert.js"></script>
		<script>window.d3 || document.write('<script src="js/d3.v4.min.js">\x3C/script>')</script>
		<script>window.job || document.write('<script src="js/javascript_advert.js">\x3C/script>')</script>
		<script>
			function getNewLineForLevel(level, data) {
				return level.selectAll(".div.line")
					.data(data)
					.enter()
					.append("div")
					.attr("class","line")
			}

			function getCategoryForLine(line, keyIndex) {
				return line.append("div")
					.attr("class", "category")
					.text(function(d) { return Object.keys(d)[keyIndex] })
			}

			function getLabelForCategory(category, categoryName) {
				return category.append("div")
					.attr("class", "label")
			}

			function renderPropertyForLabel(propertyName, label, categoryName, keyIndex) {
				let labelSpan = label.append("span")
					.attr("class", "label-wrapper")
					.text(function(d) { return Object.keys(d[categoryName])[keyIndex] })

				return label.append("div")
					.attr("class", "bar")
					.style("width", function(d) { return d[categoryName][propertyName] + "px" })
					.text(function(d) { return Math.round(d[categoryName][propertyName]) })
			}

		 	function draw(data) { 
				"use strict";

				let chart = d3.select("body")
					.append("div")
				  .attr("class", "chart")

				let profileLine = getNewLineForLevel(chart, data);
				let profileCategory = getCategoryForLine(profileLine, 4);
				let profileCategoryName = profileCategory._groups[0][0].innerText;
				let profileLabel = getLabelForCategory(profileCategory, profileCategoryName);
				renderPropertyForLabel("newfeatures", profileLabel, profileCategoryName, 0);


			  let specsLine = getNewLineForLevel(chart, data);
				let specsCategory = getCategoryForLine(specsLine, 3);
			  let specsCategoryName = specsCategory._groups[0][0].innerText;
				let specsLabel = getLabelForCategory(specsCategory, specsCategoryName);
			  renderPropertyForLabel("workload", specsLabel, specsCategoryName, 0);

			}
		</script>
	</head>
	<body>

	</body>
	<script>
		document.addEventListener("DOMContentLoaded", function(event) {
			let jsonOutput = [{}];
			function iterate(obj) {
				for (let property in obj) {
			    if (obj.hasOwnProperty(property)) {
		        jsonOutput[0][property] = obj[property];
			    }
				}
			}
			iterate(job);
			// console.log(JSON.stringify(jsonOutput, null, 2));
			draw(jsonOutput);
		});
	</script>
</html>